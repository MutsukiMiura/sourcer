!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=155)}({12:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.add=function(e,n){return e instanceof t?new t(this.x+(e.x||0),this.y+(e.y||0)):new t(this.x+(e||0),this.y+(n||0))},t.prototype.subtract=function(e,n){return e instanceof t?new t(this.x-(e.x||0),this.y-(e.y||0)):new t(this.x-(e||0),this.y-(n||0))},t.prototype.multiply=function(e){return e instanceof t?new t(this.x*e.x,this.y*e.y):new t(this.x*e,this.y*e)},t.prototype.divide=function(e){return e instanceof t?new t(this.x/e.x,this.y/e.y):new t(this.x/e,this.y/e)},t.prototype.modulo=function(e){return e instanceof t?new t(this.x%e.x,this.y%e.y):new t(this.x%e,this.y%e)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.distance=function(t){return this.subtract(t).length()},t.prototype.length=function(){return this.calculatedLength?this.calculatedLength:(this.calculatedLength=Math.sqrt(this.dot()),this.calculatedLength)},t.prototype.normalize=function(){var t=this.length(),e=0!==t?1/t:0;return this.multiply(e)},t.prototype.angle=function(){return 180*this.angleInRadians()/Math.PI},t.prototype.angleInRadians=function(){return this.calculatedAngle?this.calculatedAngle:(this.calculatedAngle=Math.atan2(-this.y,this.x),this.calculatedAngle)},t.prototype.dot=function(t){return void 0===t&&(t=this),this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.rotate=function(e){var n=e*(Math.PI/180),i=Math.cos(n),o=Math.sin(n);return new t(i*this.x-o*this.y,i*this.y+o*this.x)},t.direction=function(e){return new t(1,0).rotate(e)},t.prototype.minimize=function(){return{x:Math.round(this.x),y:Math.round(this.y)}},t}();e.default=i},129:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n,i){this.field=t,this.position=e,this.speed=n,this.length=i,this.frame=0}return t.prototype.action=function(){this.frame++,this.length<=this.frame&&this.field.removeFx(this)},t.prototype.move=function(){this.position=this.position.add(this.speed)},t.prototype.dump=function(){return{i:this.id,p:this.position.minimize(),f:this.frame,l:Math.round(this.length)}},t}();e.default=i},13:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.INITIAL_SHIELD=100,t.INITIAL_FUEL=100,t.INITIAL_MISSILE_AMMO=20,t.LASER_ATTENUATION=1,t.LASER_MOMENTUM=128,t.FUEL_COST=.24,t.COLLISION_SIZE=4,t.SCAN_WAIT=.35,t.SPEED_RESISTANCE=.96,t.GRAVITY=.1,t.TOP_INVISIBLE_HAND=480,t.DISTANCE_BORDAR=400,t.DISTANCE_INVISIBLE_HAND=.008,t.OVERHEAT_BORDER=100,t.OVERHEAT_DAMAGE_LINEAR_WEIGHT=.05,t.OVERHEAT_DAMAGE_POWER_WEIGHT=.012,t.GROUND_DAMAGE_SCALE=1,t.COOL_DOWN=.5,t.ON_HIT_SPEED_GIVEN_RATE=.4,t}();e.default=i},130:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(134),s=n(129),u=n(12),a=n(16),c=function(t){function e(e,n,i){var o=t.call(this,e,n.position.x,n.position.y)||this;return o.owner=n,o.type=i,o.temperature=0,o.damage=function(){return 0},o.breakable=!1,o}return o(e,t),e.prototype.action=function(){this.onAction();var t=this.field.checkCollision(this);t&&(t.onHit(this),this.createFxs()),this.field.checkCollisionEnviroment(this)&&(this.field.removeShot(this),this.createFxs())},e.prototype.createFxs=function(){for(var t=0;t<3;t++){var e=this.position.add(a.default.rand(16)-8,a.default.rand(16)-8),n=new u.default(a.default.rand(1)-.5,a.default.rand(1)-.5),i=a.default.rand(8)+4;this.field.addFx(new s.default(this.field,e,this.speed.divide(2).add(n),i))}},e.prototype.reaction=function(t){t.temperature+=this.temperature},e.prototype.onAction=function(){},e.prototype.dump=function(){return{o:this.owner.id,i:this.id,p:this.position.minimize(),d:this.direction,s:this.type}},e}(r.default);e.default=c},131:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.DIRECTION_RIGHT=1,t.DIRECTION_LEFT=-1,t.VERTICAL_UP="vertial_up",t.VERTICAL_DOWN="vertial_down",t}();e.default=i},132:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return function(t){var e=this;this.framesOfLife=0,this.preThink=function(){e.framesOfLife++},this.frame=function(){return e.framesOfLife},this.altitude=function(){return t.position.y},this.wait=function(e){0<e&&(t.wait+=e)}}}();e.default=i},133:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.isAccepted=!1}return t.prototype.validate=function(){if(!this.isAccepted)throw new Error("Invalid command.")},t.prototype.accept=function(){this.isAccepted=!0},t.prototype.unaccept=function(){this.isAccepted=!1},t}();e.default=i},134:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),o=n(13),r=function(){function t(t,e,n){this.field=t,this.size=o.default.COLLISION_SIZE,this.wait=0,this.wait=0,this.position=new i.default(e,n),this.speed=new i.default(0,0)}return t.prototype.think=function(){this.wait<=0?(this.wait=0,this.onThink()):this.wait=this.wait-1},t.prototype.onThink=function(){},t.prototype.action=function(){},t.prototype.move=function(){this.position=this.position.add(this.speed)},t.prototype.onHit=function(t){},t.prototype.dump=function(){throw new Error("not implimentation")},t}();e.default=r},145:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.console={log:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}};var t={Object:Object,String:String,Number:Number,Boolean:Boolean,Array:Array,Date:Date,Math:Math,RegExp:RegExp,JSON:JSON,NaN:NaN,Infinity:1/0,undefined:void 0,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,console:this.console};this.argNames=Object.keys(t),this.argValues=this.argNames.map(function(e){return t[e]})}return t.prototype.isDebuggable=function(){return!0},t.prototype.getExposedConsole=function(){return this.console},t.prototype.load=function(t){var e=[];return(e=e.concat(this.argNames)).push('"use strict";\n'+t),function(t,e){function n(){return t.apply(this,e)}return n.prototype=t.prototype,new n}(Function,e).apply(void 0,this.argValues)},t}();e.default=i},146:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(132),s=n(16),u=function(t){function e(e){var n=t.call(this,e)||this;n.direction=function(){return e.direction};e.field;var i=e.command;n.fuel=function(){return e.fuel},n.scanEnemy=function(t,n,o){i.validate(),e.wait+=1.5;var r=e.opposite(t),u=s.default.createRadar(e.position,r,n,o||Number.MAX_VALUE);return e.field.scanEnemy(e.owner,u)},n.speedUp=function(){i.validate(),i.speedUp=.8},n.speedDown=function(){i.validate(),i.speedDown=.1},n.turnRight=function(){i.validate(),i.turn=-9},n.turnLeft=function(){i.validate(),i.turn=9};return n.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.validate(),e.log(t.map(function(t){return function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)?t:JSON.stringify(t)}).join(", "))},n.scanDebug=function(t,n,o){i.validate(),e.scanDebug(e.opposite(t),n,o)},n}return o(e,t),e.prototype.connectConsole=function(t){t&&(t.log=this.log.bind(this))},e}(r.default);e.default=u},147:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(133),s=n(13),u=n(12),a=function(t){function e(e){var n=t.call(this)||this;return n.missile=e,n.reset(),n}return o(e,t),e.prototype.reset=function(){this.speedUp=0,this.speedDown=0,this.turn=0},e.prototype.execute=function(){if(0<this.missile.fuel){this.missile.direction+=this.turn;var t=u.default.direction(this.missile.direction);this.missile.speed=this.missile.speed.add(t.multiply(this.speedUp)),this.missile.speed=this.missile.speed.multiply(1-this.speedDown),this.missile.fuel-=(this.speedUp+3*this.speedDown)*s.default.FUEL_COST,this.missile.fuel=Math.max(0,this.missile.fuel)}},e}(r.default);e.default=a},148:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(130),s=n(13),u=n(147),a=n(146),c=n(131),f=function(t){function e(e,n,i){var o=t.call(this,e,n,"Missile")||this;return o.bot=i,o.temperature=10,o.damage=function(){return 10+2*o.speed.length()},o.fuel=100,o.breakable=!0,o.direction=n.direction===c.default.DIRECTION_RIGHT?0:180,o.speed=n.speed,o.command=new u.default(o),o.command.reset(),o.controller=new a.default(o),o}return o(e,t),e.prototype.onThink=function(){if(this.command.reset(),!(this.fuel<=0))try{this.command.accept(),this.controller.preThink(),this.debugDump={logs:[],arcs:[]},this.controller.connectConsole(this.owner.scriptLoader.getExposedConsole()),this.bot(this.controller)}catch(t){this.command.reset(),this.debugDump.logs.push({message:"Missile function error: "+t.message,color:"red"})}finally{this.command.unaccept()}},e.prototype.onAction=function(){this.speed=this.speed.multiply(s.default.SPEED_RESISTANCE),this.command.execute(),this.command.reset()},e.prototype.onHit=function(t){this.field.removeShot(this),this.field.removeShot(t)},e.prototype.opposite=function(t){return this.direction+t},e.prototype.log=function(t){this.debugDump.logs.push({message:t})},e.prototype.scanDebug=function(t,e,n){this.debugDump.arcs.push({direction:t,angle:e,renge:n})},e.prototype.dump=function(){var e=t.prototype.dump.call(this);return this.owner.scriptLoader.isDebuggable()&&(e.debug=this.debugDump),e},e}(r.default);e.default=f},149:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(130),s=n(12),u=n(13),a=function(t){function e(e,n,i,o){var r=t.call(this,e,n,"Laser")||this;return r.direction=i,r.temperature=5,r.damage=function(){return 8},r.speed=s.default.direction(i).multiply(o),r.momentum=u.default.LASER_MOMENTUM,r}return o(e,t),e.prototype.action=function(){t.prototype.action.call(this),this.momentum-=u.default.LASER_ATTENUATION,this.momentum<0&&this.field.removeShot(this)},e}(r.default);e.default=a},150:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.laser=function(e,n){var i=new t;return i.power=Math.min(Math.max(e||8,3),8),i.direction=n,i.shotType="Laser",i},t.missile=function(e){var n=new t;return n.bot=e,n.shotType="Missile",n},t}();e.default=i},151:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(132),s=n(13),u=n(16),a=n(150),c=function(t){function e(e){var n=t.call(this,e)||this;n.shield=function(){return e.shield},n.temperature=function(){return e.temperature},n.missileAmmo=function(){return e.missileAmmo},n.fuel=function(){return e.fuel};var i=e.field,o=e.command;n.scanEnemy=function(t,n,r){o.validate(),e.wait+=s.default.SCAN_WAIT;var a=e.opposite(t),c=r||Number.MAX_VALUE,f=u.default.createRadar(e.position,a,n,c);return i.scanEnemy(e,f)},n.scanAttack=function(t,n,r){o.validate(),e.wait+=s.default.SCAN_WAIT;var a=e.opposite(t),c=r||Number.MAX_VALUE,f=u.default.createRadar(e.position,a,n,c);return i.scanAttack(e,f)},n.ahead=function(){o.validate(),o.ahead=.8},n.back=function(){o.validate(),o.ahead=-.4},n.ascent=function(){o.validate(),o.ascent=.9},n.descent=function(){o.validate(),o.ascent=-.9},n.turn=function(){o.validate(),o.turn=!0},n.fireLaser=function(t,e){o.validate(),o.fire=a.default.laser(e,t)},n.fireMissile=function(t){o.validate(),o.fire=a.default.missile(t)};return n.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];o.validate(),e.log(t.map(function(t){return function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)?t:JSON.stringify(t)}).join(", "))},n.scanDebug=function(t,n,i){o.validate(),e.scanDebug(e.opposite(t),n,i)},n}return o(e,t),e.prototype.connectConsole=function(t){t&&(t.log=this.log.bind(this))},e}(r.default);e.default=c},152:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(133),s=n(13),u=function(t){function e(e){var n=t.call(this)||this;return n.sourcer=e,n.reset(),n}return o(e,t),e.prototype.reset=function(){this.ahead=0,this.ascent=0,this.turn=!1,this.fire=null},e.prototype.execute=function(){this.fire&&this.sourcer.fire(this.fire),this.turn&&(this.sourcer.direction*=-1),0<this.sourcer.fuel&&(this.sourcer.speed=this.sourcer.speed.add(this.ahead*this.sourcer.direction,this.ascent),this.sourcer.fuel-=(Math.abs(this.ahead)+Math.abs(this.ascent))*s.default.FUEL_COST,this.sourcer.fuel=Math.max(0,this.sourcer.fuel))},e}(r.default);e.default=u},153:function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(134),s=n(152),u=n(151),a=n(13),c=n(131),f=n(16),h=n(12),l=n(149),p=n(148),d=n(129),m=function(t){function e(e,n,i,o,r,f,h){var l=t.call(this,e,n,i)||this;return l.aiSource=o,l.account=r,l.name=f,l.color=h,l.alive=!0,l.temperature=0,l.shield=a.default.INITIAL_SHIELD,l.missileAmmo=a.default.INITIAL_MISSILE_AMMO,l.fuel=a.default.INITIAL_FUEL,l.bot=null,l.direction=Math.random()<.5?c.default.DIRECTION_RIGHT:c.default.DIRECTION_LEFT,l.command=new s.default(l),l.controller=new u.default(l),l}return o(e,t),e.prototype.compile=function(t){if(this.scriptLoader=t,this.bot=t.load(this.aiSource),!this.bot)throw{message:"Function has not been returned."};if("function"!=typeof this.bot)throw{message:"Returned is not a Function."}},e.prototype.onThink=function(){if(null!==this.bot&&this.alive)try{this.command.accept(),this.controller.preThink(),this.debugDump={logs:[],arcs:[]},this.controller.connectConsole(this.scriptLoader.getExposedConsole()),this.bot(this.controller)}catch(t){this.debugDump.logs.push({message:"Sourcer function error: "+t.message,color:"red"}),this.command.reset()}finally{this.command.unaccept()}},e.prototype.action=function(){if(!this.alive&&f.default.rand(8)<1){var t=this.position.add(f.default.rand(16)-8,f.default.rand(16)-8),e=new h.default(f.default.rand(1)-.5,f.default.rand(1)+.5),n=f.default.rand(8)+4;this.field.addFx(new d.default(this.field,t,e,n))}if(this.speed=this.speed.multiply(a.default.SPEED_RESISTANCE),this.speed=this.speed.subtract(0,a.default.GRAVITY),a.default.TOP_INVISIBLE_HAND<this.position.y){var i=.1*(this.position.y-a.default.TOP_INVISIBLE_HAND);this.speed=this.speed.subtract(0,a.default.GRAVITY*i)}var o=this.field.center-this.position.x;if(a.default.DISTANCE_BORDAR<Math.abs(o)){var r=o<0?-1:1,s=(Math.abs(o)-a.default.DISTANCE_BORDAR)*a.default.DISTANCE_INVISIBLE_HAND*r;this.position=new h.default(this.position.x+s,this.position.y)}this.position.y<0&&(this.shield-=-this.speed.y*a.default.GROUND_DAMAGE_SCALE,this.position=new h.default(this.position.x,0),this.speed=new h.default(this.speed.x,0)),this.temperature-=a.default.COOL_DOWN,this.temperature=Math.max(this.temperature,0);var u=this.temperature-a.default.OVERHEAT_BORDER;if(0<u){var c=u*a.default.OVERHEAT_DAMAGE_LINEAR_WEIGHT,l=Math.pow(u*a.default.OVERHEAT_DAMAGE_POWER_WEIGHT,2);this.shield-=c+l}this.shield=Math.max(0,this.shield),this.command.execute(),this.command.reset()},e.prototype.fire=function(t){if("Laser"===t.shotType){var e=this.opposite(t.direction),n=new l.default(this.field,this,e,t.power);n.reaction(this),this.field.addShot(n)}if("Missile"===t.shotType&&0<this.missileAmmo){var i=new p.default(this.field,this,t.bot);i.reaction(this),this.missileAmmo--,this.field.addShot(i)}},e.prototype.opposite=function(t){return this.direction===c.default.DIRECTION_LEFT?f.default.toOpposite(t):t},e.prototype.onHit=function(t){this.speed=this.speed.add(t.speed.multiply(a.default.ON_HIT_SPEED_GIVEN_RATE)),this.shield-=t.damage(),this.shield=Math.max(0,this.shield),this.field.removeShot(t)},e.prototype.log=function(t){this.debugDump.logs.push({message:t})},e.prototype.scanDebug=function(t,e,n){this.debugDump.arcs.push({direction:t,angle:e,renge:n})},e.prototype.dump=function(){var t={i:this.id,p:this.position.minimize(),d:this.direction,h:Math.ceil(this.shield),t:Math.ceil(this.temperature),a:this.missileAmmo,f:Math.ceil(this.fuel)};return this.scriptLoader.isDebuggable()&&(t.debug=this.debugDump),t},e}(r.default);e.default=m},154:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{a(i.next(t))}catch(t){r(t)}}function u(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,u)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(12),s=n(153),u=n(16),a=function(){function t(t,e){void 0===e&&(e=!1),this.scriptLoaderConstructor=t,this.isDemo=e,this.currentId=0,this.isFinished=!1,this.dummyEnemy=new r.default(0,150),this.frame=0,this.sourcers=[],this.shots=[],this.fxs=[]}return t.prototype.registerSourcer=function(t,e,n,i){var o=this.sourcers.length%2==0?-1:1,r=u.default.rand(80)+160*o,a=u.default.rand(160)+80;this.addSourcer(new s.default(this,r,a,t,e,n,i))},t.prototype.process=function(t,e){return i(this,void 0,void 0,function(){var n,i,r;return o(this,function(o){switch(o.label){case 0:n=0,i=this.sourcers,o.label=1;case 1:return n<i.length?(r=i[n],t.onPreThink(r.id),[4,t.waitNextTick()]):[3,5];case 2:return o.sent(),e(r),t.onPostThink(r.id),[4,t.waitNextTick()];case 3:o.sent(),o.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},t.prototype.compile=function(t){return i(this,void 0,void 0,function(){var e=this;return o(this,function(n){return[2,this.process(t,function(n){try{n.compile(new e.scriptLoaderConstructor)}catch(e){t.onError("There is an error in your code:　"+e.message)}})]})})},t.prototype.addSourcer=function(t){t.id=this.currentId++,this.sourcers.push(t)},t.prototype.addShot=function(t){t.id=this.currentId++,this.shots.push(t)},t.prototype.removeShot=function(t){var e=this.shots.indexOf(t);0<=e&&this.shots.splice(e,1)},t.prototype.addFx=function(t){t.id=this.currentId++,this.fxs.push(t)},t.prototype.removeFx=function(t){var e=this.fxs.indexOf(t);0<=e&&this.fxs.splice(e,1)},t.prototype.tick=function(t){return i(this,void 0,void 0,function(){var e=this;return o(this,function(n){switch(n.label){case 0:return 0===this.frame&&t.onFrame(this.dump()),this.center=this.computeCenter(),[4,this.process(t,function(t){t.think(),e.shots.filter(function(e){return e.owner.id===t.id}).forEach(function(t){return t.think()})})];case 1:return n.sent(),this.sourcers.forEach(function(t){return t.action()}),this.shots.forEach(function(t){return t.action()}),this.fxs.forEach(function(t){return t.action()}),this.sourcers.forEach(function(t){return t.move()}),this.shots.forEach(function(t){return t.move()}),this.fxs.forEach(function(t){return t.move()}),this.checkFinish(t),this.checkEndOfGame(t),this.frame++,t.onFrame(this.dump()),[2]}})})},t.prototype.checkFinish=function(t){if(this.isDemo)128<this.frame&&(this.result={frame:this.frame,timeout:null,isDraw:null,winnerId:null},t.onFinished(this.result));else if(!this.result){this.sourcers.forEach(function(t){t.alive=0<t.shield});var e=this.sourcers.filter(function(t){return t.alive});if(!(1<e.length)){if(1===e.length){var n=e[0];return this.result={winnerId:n.id,frame:this.frame,timeout:null,isDraw:!1},void t.onFinished(this.result)}this.result={winnerId:null,timeout:null,frame:this.frame,isDraw:!0},t.onFinished(this.result)}}},t.prototype.checkEndOfGame=function(t){if(!this.isFinished&&this.result)return this.isDemo?(this.isFinished=!0,void t.onEndOfGame()):void(this.result.frame<this.frame-90&&(this.isFinished=!0,t.onEndOfGame()))},t.prototype.scanEnemy=function(t,e){return this.isDemo&&1===this.sourcers.length?e(this.dummyEnemy):this.sourcers.some(function(n){return n.alive&&n!==t&&e(n.position)})},t.prototype.scanAttack=function(t,e){var n=this;return this.shots.some(function(i){return i.owner!==t&&e(i.position)&&n.isIncoming(t,i)})},t.prototype.isIncoming=function(t,e){var n=t.position,i=e.position,o=n.distance(i);return n.distance(i.add(e.speed))<o},t.prototype.checkCollision=function(t){var e=t.position,n=t.position.add(t.speed),i=this.shots.find(function(i){return i.breakable&&i.owner!==t.owner&&u.default.calcDistance(e,n,i.position)<t.size+i.size});if(i)return i;var o=this.sourcers.find(function(i){return i.alive&&i!==t.owner&&u.default.calcDistance(e,n,i.position)<t.size+i.size});return o||null},t.prototype.checkCollisionEnviroment=function(t){return t.position.y<0},t.prototype.computeCenter=function(){var t=0,e=0;return this.sourcers.forEach(function(n){n.alive&&(e+=n.position.x,t++)}),e/t},t.prototype.players=function(){var t={};return this.sourcers.forEach(function(e){t[e.id]={name:e.name||e.account,account:e.account,color:e.color}}),t},t.prototype.dump=function(){var t=[],e=[],n=[];this.sourcers.forEach(function(e){t.push(e.dump())});return this.shots.forEach(function(t){e.push(t.dump())}),this.fxs.forEach(function(t){n.push(t.dump())}),{f:this.frame,s:t,b:e,x:n}},t}();e.default=a},155:function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{a(i.next(t))}catch(t){r(t)}}function u(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,u)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}},r=this;Object.defineProperty(e,"__esModule",{value:!0});var s=n(154),u=n(145),a=0,c={};onmessage=function(t){var e=t.data;if(void 0!==e.issuedId)return c[e.issuedId](),void delete c[e.issuedId];var n=e,f=n.isDemo,h=n.sources,l=[],p={waitNextTick:function(){return i(r,void 0,void 0,function(){return o(this,function(t){return[2,new Promise(function(t){var e=a++;c[e]=t,postMessage({issuedId:e,command:"Next"})})]})})},onPreThink:function(t){postMessage({command:"PreThink",id:t})},onPostThink:function(t){postMessage({command:"PostThink",id:t,loadedFrame:l.length})},onFrame:function(t){l.push(t)},onFinished:function(t){postMessage({result:t,command:"Finished"})},onEndOfGame:function(){postMessage({frames:l,command:"EndOfGame"})},onError:function(t){postMessage({error:t,command:"Error"})}},d=new s.default(u.default,f);h.forEach(function(t,e){d.registerSourcer(t.source,t.name,t.name,t.color)}),postMessage({command:"Players",players:d.players()}),setTimeout(function(){return i(r,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:return[4,d.compile(p)];case 1:e.sent(),t=0,e.label=2;case 2:return t<1e4&&!d.isFinished?[4,d.tick(p)]:[3,5];case 3:e.sent(),e.label=4;case 4:return t++,[3,2];case 5:return[2]}})})},0)}},16:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(12),o=function(){function t(){}return t.createRadar=function(e,n,i,o){var r=function(t){return e.distance(t)<=o};if(360<=i)return r;var s=t.side(e,n+i/2),u=t.side(e,n+180-i/2);return i<180?function(t){return s(t)&&u(t)&&r(t)}:function(t){return(s(t)||u(t))&&r(t)}},t.side=function(e,n){var o=t.toRadian(n),r=new i.default(Math.cos(o),Math.sin(o)),s=e.x*r.y-e.y*r.x-1e-11;return function(t){return 0<=t.x*r.y-t.y*r.x-s}},t.calcDistance=function(t,e,n){var i=e.subtract(t),o=n.subtract(t);if(i.dot(o)<1e-11)return o.length();var r=t.subtract(e),s=n.subtract(e);return r.dot(s)<1e-11?s.length():Math.abs(i.cross(o)/i.length())},t.toRadian=function(t){return t*(Math.PI/180)},t.toOpposite=function(e){var n=t.normalizeDegree(e);return n<=180?2*(90-n)+n:2*(270-n)+n},t.normalizeDegree=function(t){var e=t%360;return e<0?e+360:e},t.rand=function(t){return Math.random()*t},t}();e.default=o}});